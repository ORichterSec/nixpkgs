diff --git a/src/jitterentropy-base.c b/src/jitterentropy-base.c
index 3e250c1..d94be64 100644
--- a/src/jitterentropy-base.c
+++ b/src/jitterentropy-base.c
@@ -380,7 +380,7 @@ static inline uint32_t jent_memsize(unsigned int flags)
 	if (!memsize)
 		memsize = JENT_MEMORY_SIZE;
 
-	return memsize;
+	return max_memsize;
 }
 
 static int jent_selftest_run = 0;
diff --git a/tests/raw-entropy/recording_userspace/Makefile.hashtime b/tests/raw-entropy/recording_userspace/Makefile.hashtime
index 82b8472..ab482c9 100644
--- a/tests/raw-entropy/recording_userspace/Makefile.hashtime
+++ b/tests/raw-entropy/recording_userspace/Makefile.hashtime
@@ -2,6 +2,7 @@
 
 CC ?= gcc
 CFLAGS +=-Wextra -Wall -pedantic -fPIC -O0
+CFLAGS += -DJENT_CONF_ENABLE_INTERNAL_TIMER
 #Hardening
 CFLAGS +=-fwrapv --param ssp-buffer-size=4 -fvisibility=hidden -fPIE -Wcast-align -Wmissing-field-initializers -Wshadow -Wswitch-enum
 LDFLAGS +=-Wl,-z,relro,-z,now
